# 2026-02-15

## Aster Bot Crash-Loop Investigation (~4:00 AM PST)
- Bot halted with "3+ consecutive API errors" and entered crash-loop
- Investigated: ALL Aster API endpoints working fine (public + authenticated + order place/cancel)
- **Root cause is NOT Aster outage or IP block** — it's something in the bot's trading logic
- Suspect: adaptive params were at floor values (TP=0.6%, deviation=1.2%) which may produce tiny order sizes hitting $5 minimum notional
- Aster minimum notional: $5.0 per order (confirmed via error code -4164)
- Bot error logging is too sparse — only logs "3+ consecutive API errors" without the actual error details
- **TODO**: Add actual error message logging to halt output in aster_trader.py
- **TODO**: Investigate whether small adaptive params → sub-$5 notional orders → cascade failures
- Open positions at time of halt: LONG #59 (1.27 qty @ $31.54 avg), SHORT #63 (0.43 qty @ $30.855)
- Equity: $335.93, PnL: +$43.96 (+15.06%)

## API Test Scripts Created
- `trading/test_api.ps1` — public endpoint checks
- `trading/test_api2.py` — authenticated endpoint checks  
- `trading/test_api3.py` — order place/cancel test
- These can be reused for future diagnostics

## Bot Code Fixes Applied
- Auto-clear transient halts (API errors) on restart — prevents crash-loop when connectivity returns
- Better ping error logging — now prints actual exception
- Edit location: `trading/aster_trader.py` load_state() and ping() methods

## Coin Scanner / Auto-Rotation System Built (~4:22 AM)
- Brett requested system to find optimal coins for DCA bot and rotate automatically
- **Two-tier architecture** (Brett's idea to avoid expensive backtests on all coins):
  - Tier 1 (`trading/coin_scanner_t1.py`): Cheap filter — ADX, ATR%, Hurst, SMA crosses, volume. Scans ALL Aster pairs (275 found). Seconds per coin.
  - Tier 2 (`trading/coin_scanner_t2.py`): Deep scan — full 14-day 5m backtest with our params. Only runs on Tier 1 shortlist (~13 coins).
  - Runner: `trading/run_scanner.py` — ties both tiers, outputs recommendation
- **First scan results**: BERA/USDT scored #1 (62.9) vs HYPE (46.2), 0.73% daily ROI, 5.9 deals/day
- ZAMA/USDT #2 (59.5), then HYPE #3
- **Known issue**: Hurst calculation broken (all showing 1.0+), fix in progress
- Rotation threshold: new coin must score >20% better to recommend switch
- Output files: `trading/live/scanner_t1.json`, `scanner_t2.json`, `scanner_recommendation.json`

## Multi-Asset Vision (discussed)
- Brett wants to eventually split capital across 2-3 top-scored coins (diversification)
- Similar to WhiteHatFX approach but data-driven selection
- Would require refactoring aster_trader.py to manage multiple symbols
- Phase 2 project — scanner + rotation is Phase 1

## Scanner Fixes & Validation (~4:49 AM)
- Hurst calculation fixed (was broken at 1.0+, now 0.5-0.6 range)
- BERA validation: signal looked good technically but only 33 days old
- Brett flagged pump-and-dump risk for new coins — correct instinct

## Maturity Filters Added & Tuned (~5:06-5:24 AM)
- First attempt: 50% price swing, 80-day age → filtered EVERYTHING (even HYPE at 87% swing)
- **Lesson**: crypto swings much larger than traditional markets — thresholds must reflect this
- Final tuned thresholds: age 60+ days, price swing 120%, volume spike 4x, $1M volume floor
- Results: 275 pairs → 8 passed maturity → 8 passed technical
- **HYPE confirmed #1** (52.9), ASTER #2 (46.1), DOGE #3 (41.2), SOL #4, ETH #5
- BERA/ZAMA correctly filtered out as too new

## Scanner Cron Job Active
- Job ID: b9571b56-5d72-4d25-b125-d834b12ea572
- Schedule: every 4h, America/Los_Angeles, announces to Brett
- TODO: optimize speed (maturity check takes ~15-20 min for 275 pairs)
- Unicode fix: added sys.stdout.reconfigure(encoding='utf-8') to scanner scripts

## Telegram Notifications Re-enabled (~4:39 AM)
- Changed TG_ENABLED = True in aster_trader.py line 28

## Directional Awareness Added (~6:10 AM)
- Brett noticed TRENDING was always 75/25 long/short regardless of trend direction
- Added SMA50-based trend direction detection in `detect_regime()`
- Directional regimes (TRENDING, MILD_TREND, DISTRIBUTION) now flip allocation when bearish
- Example: TRENDING▼ = 25/75 long/short (favors shorts in downtrend)
- status.json includes `trend_direction: "bullish"/"bearish"`
- Log output shows ▲/▼ after regime name
- Dashboard + product page updated to reflect feature
- **Confirmed working live**: TRENDING▼ showing L:25%/S:75%

## Dashboard & Product Page Updates (~6:15-6:27 AM)
- Dashboard: regime badge shows ▲/▼ arrows with color, allocation shows direction-adjusted
- Product page: Layer 3 updated, allocation table shows bullish vs bearish, evolution timeline updated
- Brett asked about multi-coin dashboard vision — presented plan for portfolio view, coin selector panel, per-coin cards, rotation history
- Awaiting Brett's decision: build forward-looking mockups now vs wait for actual multi-coin bot refactor

## PowerShell Escaping Issues (Recurring)
- `$_` gets eaten in inline powershell via exec tool
- Workaround: write .ps1 scripts and run with -File flag
- Created `trading/restart_bot.ps1` for reliable bot restarts
